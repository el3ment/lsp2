(function(){define(["utilities/global","controllers/application"],function(){var e=window.LSP.utilities;e.register("controller","checkout",function(){var e={},t=window.LSP,n=t.assets,r=t.models.cart,i=t.utilities,s=[];return e={events:{checkout:{onLogin:function(t,n){console.log("Login"),e.proceedTo("shipping"),e.updateCart(),e.updateShippingMethods()},onLoginAsGuest:function(t,n){console.log("Login as Guest"),e.proceedTo("shipping"),e.updateCart(),e.updateShippingMethods()},onApplyPromoCode:function(e,t){console.log("Apply Promo Code")},onApplyGiftCard:function(t,n){console.log("Apply Gift Card"),e.updateCart()},onUpdateShippingMethod:function(t,n){e.updateCart()},onUpdateZipcode:function(t,n){e.hasChosenShippingMethod()?$.when(e.updateShippingMethods()).done(function(t){e.updateCart()}):e.updateShippingMethods()},onUpdateCountry:function(t,n){e.updateShippingMethods()},onUpdateBillingAddress:function(e,t){console.log("Update Billing Address")},onSaveShipping:function(n,r){console.log("Save Shipping"),$.when(e.saveShippingData()).done(function(n){var r=i.parseMicroTemplate("templates-shipping-summary",n);$("#shippingSummary").html(r),t.controllers.application.attachEvents($("#shippingSummary")),e.toggleStepVisability("shipping"),e.proceedTo("billing")})},onEditShipping:function(t,n){$("#shippingSummary").addClass("hide"),e.toggleStepVisability("shipping")},onSaveBilling:function(n,r){console.log("Save Billing"),$.when(e.saveBillingData()).done(function(n){var r=i.parseMicroTemplate("templates-billing-summary",n);$("#billingSummary").html(r),t.controllers.application.attachEvents($("#billingSummary")),e.toggleStepVisability("billing"),e.proceedTo("review")})},onEditBilling:function(t,n){$("#billingSummary").addClass("hide"),e.toggleStepVisability("billing")},onFinishOrder:function(e,t){console.log("Finish Order")}},application:{onAttachEvents:function(e,t){},onReady:function(e,t){},onInit:function(e,t){}}},assets:{},proceedTo:function(e){if($.inArray(e,s)<0){s.push(e),$(".steps .active").removeClass("active"),$(".steps ."+e).addClass("active completed");switch(e){case"shipping":$("#shippingInputPanel").removeClass("hide"),$("#loginPanels").addClass("hide");break;case"billing":$("#billingInputPanel").removeClass("hide"),$('button[data-action="saveShipping"]').html("Save Shipping"),$('button[data-action="saveShipping"].hide').removeClass("hide");break;case"review":$('button[data-action="saveBilling"]').html("Save Billing"),$('button[data-action="finishOrder"]').removeClass("hide"),$('button[data-action="saveBilling"].hide').removeClass("hide"),$(".advertisement").addClass("hide")}}},toggleStepVisability:function(e){var t=$("#"+e+"InputPanel"),n=$("#"+e+"Summary");t.hasClass("hide")?(t.removeClass("hide"),n.addClass("hide"),$('button[data-action="finishOrder"]').addClass("hide")):(t.addClass("hide"),n.removeClass("hide"),$("#shippingInputPanel").hasClass("hide")&&$("#billingInputPanel").hasClass("hide")&&$('button[data-action="finishOrder"]').removeClass("hide"))},showLoading:function(){console.log("Loading"),$(".page-checkout").addClass("loading")},hideLoading:function(){console.log("Not Loading"),$(".page-checkout").removeClass("loading")},hasChosenShippingMethod:function(){return $('#checkoutForm input[name="shipping.method"]').is(":checked")},saveShippingData:function(){e.showLoading();var t=$.Deferred(),n=i.formToObject($("#checkoutForm")[0],null,!1);return $.when().done(function(r){r=n,e.hideLoading(),t.resolve(r)}),t.promise()},saveBillingData:function(t){e.showLoading();var n=$.Deferred(),r=i.formToObject($("#checkoutForm")[0],null,!1);return $.when().done(function(t){t=r,e.hideLoading(),n.resolve(t)}),n.promise()},updateCart:function(t){console.log("Update Shipping Amount In Cart, re-render summary");var n=$.Deferred(),r=i.formToObject($("#checkoutForm")[0],null,!1);return $.when().done(function(t){var r={totals:{merchandise:{value:14},shipping:{method:"Standard Shipping",value:10},tax:{value:15},total:{value:16}},products:[{title:"this is a product title",quantity:3,mpn:"IP240",extendedPrice:22,options:"Red Sparkle Finish, Chrome Hardware",status:{description:"Ships Seperately",slug:"seperately"}},{title:"this is a product title",quantity:3,mpn:"IP240",extendedPrice:22,options:"Red Sparkle Finish, Chrome Hardware",status:{description:"Ships Seperately",slug:"seperately"}}]};e.renderCartSummary(r),n.resolve(r)}),n.promise()},renderCartSummary:function(e){var n=i.parseMicroTemplate("templates-checkout-summary",e);$("#checkoutSummary").html(n),t.controllers.application.attachEvents($("#checkoutSummary"))},updateShippingMethods:function(t){var n=$.Deferred(),r={stuff:!0};return $.when().done(function(t){var r=[{title:"Standard Shipping",delay:"3-5 days",arrivesBy:"Tuesday",amount:13.23},{title:"Express Shipping",delay:"2-3 days",arrivesBy:"Saturday",amount:13.23},{title:"Overnight Shipping",delay:"1-2 days",arrivesBy:"Thursday",amount:13.23}];e.renderShippingMethods(r),n.resolve(r)}),n},renderShippingMethods:function(e){var n=i.parseMicroTemplate("template-checkout-shippingMethods",e);$("#shippingMethods").html(n),t.controllers.application.attachEvents($("#shippingMethods"))}},e}())})})();