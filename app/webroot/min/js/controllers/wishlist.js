(function(){define(["utilities/global","controllers/application"],function(){window.parsePrice=function e(t,n){t=Math.round(t*100)/100;var r=parseInt(t/1e3),i=Math.round(t%1e3*100)/100;i<100&&(i<10?i="00"+i:i="0"+i),r>0&&(r=e(r,!0),t=r+","+i);if(!n){t+="";if(t.indexOf(".")!=-1){var s=t.substring(t.indexOf(".")+1,t.length);s.length==1&&(t+="0")}else t+=".00";return"$"+t}return t},window.getNumber=function(t){return t+="",t.indexOf("$")!=-1&&(t=t.substring(t.indexOf("$")+1).replace(",","").replace(" ","")),parseFloat(t)},window.calcSaves=function(t,n){var t=getNumber(t),n=getNumber(n),r=t-n,i=Math.round(r*1e4/t)/100;return r>0?i+"%":!1},window.addToWishlist=function(t){t.messages.hide();if(t.customer!=""){var n="";if(t.options.length===0||t.options.length>0&&t.options.find("option:selected").length===t.options.length&&(t.item.val()||"").length>0){t.options.each(function(){var e=this.id,t=$(this).attr("name"),r=$(this).find("option:selected"),i=r.val(),s=r.text();n+=t+"="+t+"=="+escape(s)+"="+escape(s)+";"});var r="/app/site/hosting/scriptlet.nl?script=customscript_add_item_wishlist&deploy=customdeploy_add_item_wishlist&i="+t.item.val()+"&j="+t.customer+"&q=1&s="+t.site+"&o="+n;$.getScript(r,function(){$("#add-wishlist").hide(),t.messages.eq(0).show()})}else $("#add-wishlist").removeClass("loading"),t.messages.eq(2).show()}else t.messages.eq(1).show()},window.drawWishlist=function(t,n,r,i,s,o,u,a,f,l,c,h){var p={id:t,url:n,thumbnailUrl:r,name:unescape(i),price:s,quantity:o,options:unescape(u),comments:unescape(a),msrp:f,stockMessage:unescape(l),mpn:unescape(c),behavior:unescape(h)};$("table.wishlist.table tbody").append(LSP.utilities.parseMicroTemplate("templates-wishlistItem",p)).parent("table").show(),$("table.wishlist .comments textarea").off("keyup.wishlist").on("keyup.wishlist",function(){$(this).val().length>0&&($(".wish-update",this.parentNode).fadeIn(),$(".wish-text-saved",this.parentNode).hide())})},window.wishlistReady=function(t){document.location.href.indexOf("austintest")!=-1&&alert(t)},window.wishStatusText=function(t){t=="T"?($('input[type="radio"][name="isPublic"][value="true"]').attr("checked",!0),$("#wishlistStatus").removeClass("loading").html("public")):($('input[type="radio"][name="isPublic"][value="false"]').attr("checked",!0),$("#wishlistStatus").removeClass("loading").html("private"))},window.myWishlist=function(t){if(t.customer!=""){t.messages.filter(".loggedIn").show();var n=new Date,r="/app/site/hosting/scriptlet.nl?script=customscript_show_my_wishlist&deploy=customdeploy_show_my_wishlist&j="+t.customer+"&s=lonestarpercussion&random="+Math.random()*n.getTime();$("table.wishlist.table tbody").addClass("loading small"),$.getScript(r,function(e){$("#wish-info").show();if(e=="")t.messages.filter(".emptyWishlist").show(),$("#wishlistStatus").html("empty"),$("table.wishlist.table tbody").removeClass("loading");else{$("table.wishlist.table tbody").removeClass("loading");var r=$("#wishlist-wrapper tbody"),i=$("#wishlist-messages > div"),s=$("#wish-pub"),o=null,u=e.substring(e.indexOf("Ready('")+7);u=u.substring(0,u.indexOf("'")),wishStatusText(u),$('input[type="radio"][name="isPublic"]').click(function(){var e=$(this).val().substr(0,1).toUpperCase();o&&clearTimeout(o);var r="/app/site/hosting/scriptlet.nl?script=customscript_update_wishlist_public&deploy=customdeploy_update_wishlist_public&j="+t.customer+"&p="+e+"&random="+Math.random()*n.getTime();$("#wishlistStatus").addClass("loading small"),$.getScript(r,function(){wishStatusText(e)})}),$(function(){r.find(".wish-remove").click(function(){var e=$(this),n=$(this).data("id"),s=$(this).data("options");return $.getScript("/app/site/hosting/scriptlet.nl?script=customscript_remove_item_wishlist&deploy=customdeploy_remove_item_wishlist&j="+t.customer+"&i="+n+"&o="+s,function(){e.closest("tr").fadeOut(function(){$(this).remove(),r.find(".wishlistItem").length==0&&(i.filter(".emptyWishlist").show(),r.closest("table.wishlist").hide(),r.closest("h2").hide())})}),!1}),r.find(".wish-update").click(function(){var e=$(this).parent(),n=$(this).data("id"),r=escape(e.parent().find("textarea").val()),i="/app/site/hosting/scriptlet.nl?script=customscript_update_wishlist_comments&deploy=customdeploy_update_wishlist_comments&i="+n+"&j="+t.customer+"&t="+r+"&o="+$(this).data("options");return $.getScript(i,function(){var t=e.parent().find(".wish-text-saved");t.fadeIn(),$(".wish-update",e).hide()}),!1})})}})}else t.messages.hide().filter(".notLoggedIn").show()},window.addCustomer=function(t,n,r,i){var s="<div class='wish-result'>";s+="<a href='#'>"+unescape(n)+" "+unescape(r)+" - "+i+"</a>",s+="<input type='hidden' value='"+t+"' />",s+="</div>",$("#wish-search-results").append(s)},window.searchWishlist=function(t){var n=new Date;$.getScript("/app/site/hosting/scriptlet.nl?script=customscript_search_wishlist&deploy=customdeploy_search_wishlist&st="+t.searchText+"&random="+Math.random()*n.getTime(),function(){t.messages.hide(),$(function(){var e=$("#wishlist-wrapper"),n=$("#wish-search-results");n.find(".wish-result").length==0?t.messages.eq(2).show():(t.messages.eq(4).show(),n.find("a").click(function(){t.messages.eq(7).hide();var n=$(this).text(),r=LSP.utilities.cleanTrailing(n.substr(0,n.indexOf(" - ")));r.length===0&&(r=n.substr(n.indexOf(" - ")+3,300)),$(this).parent().siblings().remove(),$("h2").html("Wishlist for "+r).show(),e.hide().find("tbody tr:not(#wish-item-template)").remove();var i=$(this).next().val();return $.getScript("/app/site/hosting/scriptlet.nl?script=customscript_show_my_wishlist&deploy=customdeploy_show_my_wishlist&j="+i+"&s="+t.site,function(){e.find("tbody tr:not(#wish-item-template)").length>0?e.show().find(".wish-add-cart").click(function(){var e=$(this).parent(),n=e.find(".wish-id").val(),r=e.find(".wish-qty").val(),i=e.find(".wish-options-values").val(),s="/app/site/backend/additemtocart.nl?c="+t.account+"&buyid="+n+"&qty="+r+i+"&continue=/Search-Wishlist?searchtext="+t.searchText;return document.location=s,!1}):t.messages.eq(7).show()}),!1}),t.messages.eq(6).show())})})},function(){var e=window.LSP.utilities;e.register("controller","wishlist",function(){var e={},t=window.LSP;return e={name:"wishlist",events:{application:{onReady:function(e,t){(LSP.config||{}).wishlist&&myWishlist(LSP.config.wishlist.myWishlistSettings);var n=$("#search-wish"),r=$("#search-wish-text"),i=$(".wishlist-messages > div");r.keyup(function(e){e.keyCode==13&&n.trigger("click")}),n.off("wishlist").on("click.wishlist",function(){i.hide(),$(".resultsHeader").hide(),$("#wish-search-results").html(""),$("#wishlist-wrapper").hide().find("tbody tr:not(#wish-item-template)").remove(),r.val()!=""?r.val().length>2?(i.eq(1).show(),searchWishlist({account:"665798",messages:i,searchText:r.val(),site:"lonestarpercussion"})):i.eq(5).show():i.eq(0).show()});var s=window.location.href;if(s.indexOf("searchtext")!=-1){var o=s.substring(s.indexOf("searchtext")+11);o=o.substring(0,o.indexOf("&")),r.val(o),n.click()}}}},assets:{}},e}())}()})})();