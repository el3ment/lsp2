(function(){define("models/api",["utilities/global","controllers/application"],function(){var e=window.LSP,t=e.utilities;t.register("model","api",{_timeout:15e3,_url:function(e,t){return""},_payload:function(e,t){return t},_isSuccess:function(e){return(e||{}).success===!0},_afterSuccess:function(e){return e},_request:function(n,r,i,s,o,u){var a=$.Deferred(),f={};return $.support.cors=!0,f.xhrData={type:n,url:this._url(i,o),data:this._payload(i,o),crossDomain:!0,dataType:r,context:this,timeout:this._timeout,passthrough:$.extend({},u)},console.log("API Request Sent via "+s,f.xhrData),$(e.controllers.application).triggerHandler("onBeforeAPICall",f),$(i).triggerHandler("onBeforeAPICall",f),$(i).triggerHandler(t.camelCase("on-Before-API-"+s+"-call"),f),$.ajax(f.xhrData).done(function(e){f.serverResponse=e;try{f.response=$.parseJSON(e)}catch(t){f.response=e}this._isSuccess(e)?(f.response=this._afterSuccess(f.response),a.resolve(f)):(f.error="invalidFormat",a.reject(f))}).fail(function(e){f.serverResponse=e;try{f.response=$.parseJSON(e.responseText)}catch(t){f.response=e}a.reject(f)}).always(function(){console.log("API Response Recieved via "+s,f)}),$.when(a).done(function(n){$(e.controllers.application).triggerHandler("onAfterAPICallSuccess",n),$(i).triggerHandler("onAfterAPICallSuccess",n),$(i).triggerHandler(t.camelCase("on-after-API-"+s+"-success"),n)}).fail(function(n){$(e.controllers.application).triggerHandler("onAfterAPICallFailure",n),$(i).triggerHandler("onAfterAPICallFailure",n),$(i).triggerHandler(t.camelCase("on-after-API-"+s+"-failure"),n)}).always(function(n){$(e.controllers.application).triggerHandler("onAfterAPICall",n),$(i).triggerHandler("onAfterAPICall",n),$(i).triggerHandler(t.camelCase("on-after-API-"+s),n)}),a.promise()},request:function(e,t,n,r){return this._request("GET","jsonp",e,t,n,r)}})})})(),function(){define("models/netsuite",["utilities/global","controllers/application","models/api"],function(){var e=window.LSP.utilities,t=window.LSP.models;e.register("model","netsuite",function(){var e=$.extend({},t.api);return $.extend(e,{_url:function(e,t){var n="https://forms.netsuite.com/app/site/hosting/scriptlet.nl";return n=t.method.match("getUPS")?"https://d2bghjaa5qmp6f.cloudfront.net/shipping/"+t.method:n,n},_payload:function(e,t){return $.extend(t,{method:t.method,deploy:"1",script:"25",h:"55cda7fb2a0d8a937f00",compid:"665798"})},request:function(e,t,n,r){return this._request("GET","jsonp",e,t,{data:r,method:n})}})}())})}(),function(){define("controllers/shipping",["utilities/global","models/netsuite","controllers/application"],function(){var e=window.LSP.utilities,t=function(){var t={},n=window.LSP,r=n.models.netsuite,i={bodyNoTrackingNumbersFoundClass:"shipping-noTrackingNumbersFound",trackingNumberSelector:".testOnly-trackingNumbers"};return t={name:"shipping",events:{application:{onAttachEvents:function(e,n){$("#search-orders-form",n.selector).bind("submit",function(e){return t.handleSubmit({orderNumber:$('.page-trackOrder input[name="orderNumber"]').val()||"",billingZip:$('.page-trackOrder input[name="billingZip"]').val()||""}),e.preventDefault(),!1})}}},assets:{},handleSubmit:function(e){$("#responseTable").addClass("loading"),$("#responseTable table").hide(),$.when(t.requestTrackingNumber(e.orderNumber,e.billingZip)).done(function(e){t.renderTrackingData(t.parseAPIResponse(e.response.data))}).fail(function(e){$("#responseTable").html($("#templates-trackOrder-error").html())}).always(function(){$("#responseTable").removeClass("loading")})},renderTrackingData:function(t){var n=e.parseMicroTemplate("templates-trackingResponse",t);$("#responseTable").html(n)},parseAPIResponse:function(e){var n=e.trackingnumbers.split("<BR>"),r=[];for(var i=0;i<n.length;i++){var s=t.getCarrierFromTrackingNumber(n[i]);r.push({orderId:e.internalid.value,orderDate:e.trandate,orderNumber:e.number,orderEmail:e.email,trackingNumber:n[i],trackingUrl:s=="ups"?"http://wwwapps.ups.com/ietracking/tracking.cgi?tracknum="+n[i]:"https://tools.usps.com/go/TrackConfirmAction.action?tLabels="+n[i],carrier:s})}return r},getCarrierFromTrackingNumber:function(e){return e.substr(0,2).toUpperCase()=="1Z"?"ups":"usps"},requestTrackingNumber:function(e,n){return r.request(t,"getTrackingNumber","getTrackingNumber",{orderNumber:$.trim(e),billingZip:$.trim(n)})}},t}();e.register("controller","shipping",t)})}();