(function(){define(["utilities/global","controllers/application"],function(){var _util=window.LSP.utilities;_util.register("controller","checkout",function(){var _this={},_app=window.LSP,_assets=_app.assets,_util=_app.utilities,_state={},_mainTable="body .span12 > table";return _this={events:{checkout:{onInit:function(e,t){LSP.config=LSP.config||{},_this.setPage(LSP.config.setPage)},onEnterCart:function(e,data){var timeout;$('a[href="#"]').attr("href",null),$('input[name="checkout"]').attr("formnovalidate",!0).click(function(){setTimeout(function(){clearTimeout(timeout)},1e3)}).parent().click(function(){timeout=setTimeout(function(){_gaq.push(["_trackEvent","cart","error","5 seconds have passed since clicking proceed to checkout"])},5e3)}),$('td.uir-list-row-cell:nth-child(4):not(:contains(":"))').addClass("hidden-phone");if($(".extcartborder").length){$("tr[id*=carttablerow] ~ tr:not([id])").addClass("tablefooter").last().addClass("total");var rows=$(".tablefooter");$(rows[0]).addClass("footerMerch"),$(rows[1]).addClass("footerTax"),$(rows[2]).addClass("footerShip"),$(rows[3]).addClass("footerOther"),$(rows[4]).addClass("footerTotal"),$('.footerTotal b:contains("Subtotal"):last').text("Order Total");var countryInput=$('select[name="country"]').detach().wrap('<div class="shipInput countryInput"></div>').parent(),zipInput=$("#zip").detach().wrap('<div class="shipInput zipInput"></div>').parent(),carrierInput=$("#shippingcarrierselect").detach().wrap('<div class="shipInput carrierInput"></div>').parent(),carrierChoices=$("<table class='carrierChoices'></table>");$('input[type="radio"][name="sShipMeth"]').parent().wrap("<tr></tr>").parent().prependTo(carrierChoices);var shipLine=$(".footerShip > td:first-child").attr("colspan","0").attr("style","display:none!important;").next().attr("colspan","6");$(".footerMerch .texttable:not(:last-child)").remove(),$(".footerMerch td:first-child").attr("colspan","6"),$(".footerTotal .extcartborder").remove(),$(".footerTotal .extcarttotal").attr("colspan","6"),$('<input id="countryforminput" name="country" type="hidden">').prependTo('form[name="cart"]'),$('<input id="zipforminput" name="zip" type="hidden">').prependTo('form[name="cart"]'),$('<input id="shippingcarrierforminput" name="shippingcarrierselect" type="hidden">').prependTo('form[name="cart"]'),$('<input id="shipmethforminput" name="sShipMeth" type="hidden">').prependTo('form[name="cart"]'),$("select option[selected]",carrierInput).text().replace(/^\s\s*/,"").replace(/\s\s*$/,"")=="More"&&$(carrierChoices).attr("style","display: none !important;"),$('option:contains("More")',carrierInput).text("Standard (2-6 Days)"),$(zipInput).prependTo(shipLine),$(countryInput).prependTo(shipLine),$(carrierInput).prependTo(shipLine),$(carrierChoices).appendTo(shipLine),$("b",shipLine).replaceWith($('<div class="label">Shipping<div class="details" style="font-weight:normal !important;">Enter your zip code</div></div>')),$("select",carrierInput).attr("onchange","").on("change",function(){$("#shippingcarrierforminput").val($(this).val()),$(this).val()=="nonups"&&eval($(".footerShip script").html().replace("&sShipMeth=","&sShipMeth=51489")),shippingSelectOnChange()}),$(":input",countryInput).on("change",function(){$("#countryforminput").val($(this).val())}),$("#countryforminput").val($(":input",countryInput).val()),$("#shipmethforminput").val($('input[type="radio"][name="sShipMeth"][checked]').val()),$("#zipforminput").val($(":input",zipInput).val()),$("#shippingcarrierforminput").val($(":input",carrierInput).val()),$(":input",countryInput).on("change",function(){$("#recalc").click()}),$(":input",zipInput).on("change",function(){$("#zipforminput").val($(this).val())}),$(".zipInput input").on("blur",function(){$("#recalc").click()}),$("#tbl_recalc").attr("style","display: none;"),$('input[size="6"], .zipInput input').one("keydown",function(){$("#tbl_recalc").attr("style","")})}$("html").attr("data-path","http://www.lonestarpercussion.com/cart")},onEnterSignup:function(e,t){$("#emailsubscribe_fs_lbl").wrap('<label for="#emailsubscribe_fs"></label>'),$("td:contains('Your password hint')").prev().addClass("hidden-phone")},onEnterAddress:function(e,t){$(".greytitle").is(':contains("Shipping")')?_this.setPage("shippingAddress"):_this.setPage("billingAddress")},onEnterShippingAddress:function(e,t){$(_mainTable+" > tbody > tr > td > table > tbody > tr.portletHandle:first-child + .noprint + .portletHandle:not(:has(#address))").css({height:"0px",visibility:"hidden"})},onEnterBillingAddress:function(e,t){},onEnterShippingMethod:function(e,t){$("#kReferralCode, #applycoupon").attr("tabindex",-1)},onEnterPayment:function(e,t){$('input[name="gc"], #applygift').attr("tabindex",-1),$("#stepSlider").prependTo(".page-generic:first").wrap('<table><tr height="25"><td></td></tr></table>'),$("#paymeth > table").parent().parent().addClass("row-fluid"),$("#paymeth > table").addClass("span8").attr("style",""),$('<div class="span4 rightColumn pull-right"><div class="orderSummary"></div>').insertBefore("#paymeth > table"),$(".cart").prependTo(".orderSummary"),$('.adForPaymentPage *[class*="bsa-"]').appendTo(".rightColumn").parent().removeClass("hide"),$(".newGiftCardRow").length==0&&$('<tr class="newGiftCardRow"><td class="smalltextnolink" align="right" style="padding-top:10px;"><input id="giftCardCheckbox" type="checkbox" style="float:right;position:relative;top:10px;" onclick="window.toggleGiftCard()"></td><td style="padding-top:20px;">Do you have a gift card?<div class="details">Redeeming a Gift Card is easy!</div></tr>').insertBefore('input[name="sIssueNo"]'),$('td:contains("Apply a Gift Card"):last').attr("style","visibility: hidden;"),$('.greytitle:contains("Gift Card"):last').attr("style","display: none !important;").parent().prev().attr("style","display: none !important;"),$('tr:contains("Apply a Gift Card"):last').addClass("giftCardRow"),$('tr:contains("If you have a gift card"):last').attr("style","display: none !important;"),$('input[name="sValidFromYr"] ~ tr:contains("Invalid"):last table').attr("style","margin: 20px 5px 10px 160px;"),window.toggleGiftCard=function(){$("#giftCardCheckbox").is(":checked")?($(".giftCardRow").attr("style",""),$("#giftCardCheckbox").prop("checked",!0)):$(".giftCardRow").attr("style","display: none !important;")},window.toggleGiftCard(),$('input[name="gc"]').val().length>0&&($(".giftCardRow").show(),$('tr:contains("Do you"):last').attr("style","display: none !important;")),$('tr:contains("For most credit"):last').attr("style","display: none !important;"),$('.notice:contains("You will")').length==0&&$('<div class="notice" style="position: absolute;bottom: -110px;height: 100px;">You won&#39;t be charged yet<span class="details">You will review and place your order on the next page</span></div>').prependTo("#paymeth > table > tbody > tr:nth-child(3) > td > table > tbody > tr > td")},onEnterReview:function(e,t){$('td:contains("If you have an offer or promotion code, enter it here")').prev().addClass("hidden-phone"),$('td.uir-list-row-cell:nth-child(4):not(:contains(":"))').addClass("hidden-phone")},onEnterThankYou:function(e,t){var n=$(_mainTable+" > tbody > tr > td > table > tbody > tr > td > table > tbody > tr > td > table > tbody > tr > td > table > tbody > tr:first-child + tr > td > table,"+"#checkout table table table > tbody > tr:first-child + tr > td > table:not(.texttable table)").attr("id","carttable");$("> tbody > tr:first-child",n).attr("id","carttableheader"),$("> tbody > tr:first-child ~ tr",n).not("tr[id]").each(function(e,t){$(t).attr("id","carttablerow"+e)}),$("#ordersummary_total .texttablert:first-child b").text("Total"),$(_mainTable).addClass("nscheckout-receipt"),_gaq.push(["_trackTrans"])},onEnter:function(e,t){try{$('input[name*="email"]:not([type="checkbox"])').attr("type","email"),$('input[name*="zip"], input[name*="phone"], input[name*="sCardNum"], input[name*="ccsecuritycode"]').attr("type","tel"),$("input:not([type])").attr("type","text"),_app.controllers.netsuite.attachEnterKey()}catch(e){}t.pageName!=="address"&&(_gaq.push(["_set","title","Checkout - "+t.pageName]),_gaq.push(["_trackPageview","/checkout/"+t.pageName]))}},application:{onAttachEvents:function(e,t){},onReady:function(e,t){},onInit:function(e,t){}}},assets:{},setPage:function(e){_state.page=e,console.log("Firing Page Event : "+_util.camelCase("on-enter-"+e)),$(_this).triggerHandler(_util.camelCase("on-enter"),{selector:$(document),pageName:e}),$(_this).triggerHandler(_util.camelCase("on-enter-"+e),{selector:$(document)}),$(_mainTable).addClass("nscheckout-"+e)}},_this}());for(var i=0;i<(((LSP.config||{}).checkout||{}).page||[]).length;i++)LSP.controllers.checkout.setPage(LSP.config.checkout.page[i])})})();