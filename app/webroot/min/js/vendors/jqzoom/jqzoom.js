/*!
 * jQzoom Evolution Library v2.3  - Javascript Image magnifier
 * http://www.mind-projects.it
 *
 * Copyright 2011, Engineer Marco Renzi
 * Licensed under the BSD license.
 *
 * Redistribution and use in source and binary forms, with or without
 * modification, are permitted provided that the following conditions are met:
 *     * Redistributions of source code must retain the above copyright
 *       notice, this list of conditions and the following disclaimer.
 *     * Redistributions in binary form must reproduce the above copyright
 *       notice, this list of conditions and the following disclaimer in the
 *       documentation and/or other materials provided with the distribution.
 *     * Neither the name of the organization nor the
 *       names of its contributors may be used to endorse or promote products
 *       derived from this software without specific prior written permission.
 *
 * Date: 03 May 2011 22:16:00
 */

define(["jquery"],function(){(function($){var isIE6=$.browser&&$.browser.msie&&$.browser.version<7,body=$(document.body),window=$(window),jqzoompluging_disabled=!1;$.fn.jqzoom=function(e){return this.each(function(){var t=this.nodeName.toLowerCase();t=="a"&&new jqzoom(this,e)})},jqzoom=function(el,options){function Smallimage(image){var $obj=this;return this.node=image[0],this.findborder=function(){var bordertop=0;bordertop=image.css("border-top-width"),btop="";var borderleft=0;borderleft=image.css("border-left-width"),bleft="";if(bordertop)for(i=0;i<3;i++){var x=[];x=bordertop.substr(i,1);if(isNaN(x)!=0)break;btop=btop+""+bordertop.substr(i,1)}if(borderleft)for(i=0;i<3;i++){if(!!isNaN(borderleft.substr(i,1)))break;bleft+=borderleft.substr(i,1)}$obj.btop=btop.length>0?eval(btop):0,$obj.bleft=bleft.length>0?eval(bleft):0},this.fetchdata=function(){$obj.findborder(),$obj.w=image.width(),$obj.h=image.height(),$obj.ow=image.outerWidth(),$obj.oh=image.outerHeight(),$obj.pos=image.offset(),$obj.pos.l=image.offset().left+$obj.bleft,$obj.pos.t=image.offset().top+$obj.btop,$obj.pos.r=$obj.w+$obj.pos.l,$obj.pos.b=$obj.h+$obj.pos.t,$obj.rightlimit=image.offset().left+$obj.ow,$obj.bottomlimit=image.offset().top+$obj.oh},this.node.onerror=function(){console.error("jqZoom : Problems loading image"),_gaq.push(["_trackEvent","product","zoom","loadSmallImageError"])},this.node.onload=function(){$obj.fetchdata(),$(".zoomPad",el).length==0&&obj.create()},$obj}function Loader(){var e=this;return this.append=function(){this.node=$("<div/>").addClass("zoomPreload").css("visibility","hidden").html(settings.preloadText),$(".zoomPad",el).append(this.node)},this.show=function(){this.node.top=(smallimage.oh-this.node.height())/2,this.node.left=(smallimage.ow-this.node.width())/2,this.node.css({top:this.node.top,left:this.node.left,position:"absolute",visibility:"visible"})},this.hide=function(){this.node.css("visibility","hidden")},this}function Lens(){var e=this;return this.node=$("<div/>").addClass("zoomPup"),this.append=function(){$(".zoomPad",el).append($(this.node).hide()),settings.zoomType=="reverse"&&(this.image=new Image,this.image.src=smallimage.node.src,$(this.node).empty().append(this.image))},this.setdimensions=function(){this.node.w=parseInt(settings.zoomWidth/el.scale.x)>smallimage.w?smallimage.w:parseInt(settings.zoomWidth/el.scale.x),this.node.h=parseInt(settings.zoomHeight/el.scale.y)>smallimage.h?smallimage.h:parseInt(settings.zoomHeight/el.scale.y),this.node.top=(smallimage.oh-this.node.h-2)/2,this.node.left=(smallimage.ow-this.node.w-2)/2,this.node.css({top:0,left:0,width:this.node.w+"px",height:this.node.h+"px",position:"absolute",display:"none",borderWidth:"1px"}),settings.zoomType=="reverse"&&(this.image.src=smallimage.node.src,$(this.node).css({opacity:1}),$(this.image).css({position:"absolute",display:"block",left:-(this.node.left+1-smallimage.bleft)+"px",top:-(this.node.top+1-smallimage.btop)+"px"}))},this.setcenter=function(){this.node.top=(smallimage.oh-this.node.h-2)/2,this.node.left=(smallimage.ow-this.node.w-2)/2,this.node.css({top:this.node.top,left:this.node.left}),settings.zoomType=="reverse"&&$(this.image).css({position:"absolute",display:"block",left:-(this.node.left+1-smallimage.bleft)+"px",top:-(this.node.top+1-smallimage.btop)+"px"}),largeimage.setposition()},this.setposition=function(e){function r(e){return el.mousepos.x-e.w/2<smallimage.pos.l}function i(e){return el.mousepos.x+e.w/2>smallimage.pos.r}function s(e){return el.mousepos.y-e.h/2<smallimage.pos.t}function o(e){return el.mousepos.y+e.h/2>smallimage.pos.b}el.mousepos.x=e.pageX,el.mousepos.y=e.pageY;var t=0,n=0;t=el.mousepos.x+smallimage.bleft-smallimage.pos.l-(this.node.w+2)/2,n=el.mousepos.y+smallimage.btop-smallimage.pos.t-(this.node.h+2)/2,r(this.node)?t=smallimage.bleft-1:i(this.node)&&(t=smallimage.w+smallimage.bleft-this.node.w-1),s(this.node)?n=smallimage.btop-1:o(this.node)&&(n=smallimage.h+smallimage.btop-this.node.h-1),this.node.left=t,this.node.top=n;var u=$(this.node),a=u.attr("style");u.attr("style",a.replace(/top:[-0-9. ]{1,}px/i,"top:"+n+"px").replace(/left:[-0-9. ]{1,}px/i,"left:"+t+"px")),settings.zoomType=="reverse"&&($.browser.msie&&$.browser.version>7&&$(this.node).empty().append(this.image),$(this.image).css({position:"absolute",display:"block",left:-(this.node.left+1-smallimage.bleft)+"px",top:-(this.node.top+1-smallimage.btop)+"px"})),largeimage.setposition()},this.hide=function(){img.css({opacity:1}),this.node.hide()},this.show=function(){settings.zoomType!="innerzoom"&&(settings.lens||settings.zoomType=="drag")&&this.node.show(),settings.zoomType=="reverse"&&img.css({opacity:settings.imageOpacity})},this.getoffset=function(){var t={};return t.left=e.node.left,t.top=e.node.top,t},this}function Stage(){var e=this;this.node=$("<div class='zoomWindow'><div class='zoomWrapper'><div class='zoomWrapperTitle'></div><div class='zoomWrapperImage'></div></div></div>"),this.ieframe=$('<iframe class="zoomIframe" src="javascript:\'\';" marginwidth="0" marginheight="0" align="bottom" scrolling="no" frameborder="0" ></iframe>'),this.setposition=function(){this.node.leftpos=0,this.node.toppos=0;if(settings.zoomType!="innerzoom")switch(settings.position){case"left":this.node.leftpos=smallimage.pos.l-smallimage.bleft-Math.abs(settings.xOffset)-settings.zoomWidth>0?0-settings.zoomWidth-Math.abs(settings.xOffset):smallimage.ow+Math.abs(settings.xOffset),this.node.toppos=settings.yOffset;break;case"top":this.node.leftpos=Math.abs(settings.xOffset),this.node.toppos=smallimage.pos.t-smallimage.btop-Math.abs(settings.yOffset)-settings.zoomHeight>0?0-settings.zoomHeight-Math.abs(settings.yOffset):smallimage.oh+Math.abs(settings.yOffset);break;case"bottom":this.node.leftpos=Math.abs(settings.xOffset),this.node.toppos=smallimage.pos.t-smallimage.btop+smallimage.oh+Math.abs(settings.yOffset)+settings.zoomHeight<screen.height?smallimage.oh+Math.abs(settings.yOffset):0-settings.zoomHeight-Math.abs(settings.yOffset);break;default:this.node.leftpos=smallimage.ow+Math.abs(settings.xOffset),this.node.toppos=settings.yOffset}return this.node.css({left:this.node.leftpos+"px",top:this.node.toppos+"px"}),this},this.append=function(){$(".zoomPad",el).append(this.node),this.node.css({position:"absolute",display:"none",zIndex:5001});if(settings.zoomType=="innerzoom"){this.node.css({cursor:"default"});var t=smallimage.bleft==0?1:smallimage.bleft;$(".zoomWrapper",this.node).css({borderWidth:t+"px"})}$(".zoomWrapper",this.node).css({width:Math.round(settings.zoomWidth)+"px",borderWidth:t+"px"}),$(".zoomWrapperImage",this.node).css({width:"100%",height:Math.round(settings.zoomHeight)+"px"}),$(".zoomWrapperTitle",this.node).css({width:"100%",position:"absolute"}),$(".zoomWrapperTitle",this.node).hide(),settings.title&&zoomtitle.length>0&&$(".zoomWrapperTitle",this.node).html(zoomtitle).show(),e.setposition()},this.hide=function(){switch(settings.hideEffect){case"fadeout":this.node.fadeOut(settings.fadeoutSpeed,function(){});break;default:this.node.hide()}this.ieframe.hide()},this.show=function(){switch(settings.showEffect){case"fadein":this.node.fadeIn(),this.node.fadeIn(settings.fadeinSpeed,function(){});break;default:this.node.show()}isIE6&&settings.zoomType!="innerzoom"&&(this.ieframe.width=this.node.width(),this.ieframe.height=this.node.height(),this.ieframe.left=this.node.leftpos,this.ieframe.top=this.node.toppos,this.ieframe.css({display:"block",position:"absolute",left:this.ieframe.left,top:this.ieframe.top,zIndex:99,width:this.ieframe.width+"px",height:this.ieframe.height+"px"}),$(".zoomPad",el).append(this.ieframe),this.ieframe.show())}}function Largeimage(){var e=this;return this.node={},this.loadimage=function(e){loader.show(),this.url=e,this.node=new Image,this.node.style.position="absolute",this.node.style.border="0px",this.node.style.display="none",this.node.style.left="-5000px",this.node.style.top="0px",this.node.onload=this.afterLoad,this.node.onerror=function(e){console.error("jqZoom : problems loading large image",e),_gaq.push(["_trackEvent","product","zoom","loadLargeImageError"])},document.body.appendChild(this.node),this.node.src=e},this.afterLoad=function(){e.fetchdata(),loader.hide(),el.largeimageloading=!1,el.largeimageloaded=!0;if(settings.zoomType=="drag"||settings.alwaysOn)lens.show(),stage.show(),lens.setcenter()},this.fetchdata=function(){var t=$(this.node),n={};this.node.style.display="block",e.w=t.width(),e.h=t.height(),e.pos=t.offset(),e.pos.l=t.offset().left,e.pos.t=t.offset().top,e.pos.r=e.w+e.pos.l,e.pos.b=e.h+e.pos.t,n.x=e.w/smallimage.w,n.y=e.h/smallimage.h,el.scale=n,document.body.removeChild(this.node),$(".zoomWrapperImage",el).empty().append(this.node),lens.setdimensions()},this.setposition=function(){var e=-el.scale.x*(lens.getoffset().left-smallimage.bleft+1),t=-el.scale.y*(lens.getoffset().top-smallimage.btop+1);$(this.node).css({left:e+"px",top:t+"px"})},this}var api=null;api=$(el).data("jqzoom");if(api)return api;var obj=this,settings=$.extend({},$.jqzoom.defaults,options||{});obj.el=el,el.rel=$(el).attr("rel"),el.zoom_active=!1,el.zoom_disabled=!1,el.largeimageloading=!1,el.largeimageloaded=!1,el.scale={},el.timer=null,el.mousepos={},el.mouseDown=!1,$(el).css({"outline-style":"none","text-decoration":"none"});var img=$("img:eq(0)",el);el.title=$(el).attr("title"),el.imagetitle=img.attr("title");var zoomtitle=$.trim(el.title).length>0?el.title:el.imagetitle,smallimage=new Smallimage(img),lens=new Lens,stage=new Stage,largeimage=new Largeimage,loader=new Loader;$(el).on("click.jqzoom",function(e){return e.preventDefault(),!1});var zoomtypes=["standard","drag","innerzoom","reverse"];$.inArray($.trim(settings.zoomType),zoomtypes)<0&&(settings.zoomType="standard"),$.extend(obj,{create:function(){$(".zoomPad",el).length==0&&(el.zoomPad=$("<div/>").addClass("zoomPad"),img.wrap(el.zoomPad)),settings.zoomType=="innerzoom"&&(settings.zoomWidth=smallimage.w,settings.zoomHeight=smallimage.h),$(".zoomPup",el).length==0&&lens.append(),$(".zoomWindow",el).length==0&&stage.append(),$(".zoomPreload",el).length==0&&loader.append(),(settings.preloadImages||settings.zoomType=="drag"||settings.alwaysOn)&&obj.load(),obj.init()},init:function(){settings.zoomType=="drag"&&($(".zoomPad",el).mousedown(function(){el.mouseDown=!0}),$(".zoomPad",el).mouseup(function(){el.mouseDown=!1}),document.body.ondragstart=function(){return!1},$(".zoomPad",el).css({cursor:"default"}),$(".zoomPup",el).css({cursor:"move"})),settings.zoomType=="innerzoom"&&$(".zoomWrapper",el).css({cursor:"crosshair"}),$(".zoomPad",el).on("mouseenter.jqzoom mouseover.jqzoom",function(e){img.attr("title",""),$(el).attr("title",""),el.zoom_active=!0,smallimage.fetchdata(),el.largeimageloaded?obj.activate(e):obj.load()}),$(".zoomPad",el).bind("mouseleave.jqzoom",function(e){obj.deactivate()}),$("body").bind("touchstart.jqzoom",function(e){$(e.target).parent().is(".zoomPad")||obj.deactivate()}),$(".zoomPad",el).bind("mousemove.jqzoom mousedown.jqzoom",function(e){if(e.pageX>smallimage.pos.r||e.pageX<smallimage.pos.l||e.pageY<smallimage.pos.t||e.pageY>smallimage.pos.b)return lens.setcenter(),!1;el.zoom_active=!0,obj.activate(e),lens.setposition(e)});var e=[],t=0,n=[];n=$(".zoom-thumbnails[data-targetZoomId="+el.id+"] a");if(n.length>0){var r=n.splice(0,1);n.push(r)}n.each(function(){settings.preloadImages&&$(this).data("prezoomimage").indexOf("#")===-1&&(e[t]=new Image,e[t].src=$(this).data("prezoomimage"),t++),$(this).click(function(e){return $(this).hasClass("zoomThumbActive")?!1:(n.each(function(){$(this).removeClass("zoomThumbActive")}),e.preventDefault(),obj.swapimage(this),!1)})})},load:function(){if(el.largeimageloaded===!1&&el.largeimageloading===!1){var e=$(el).attr("href");largeimage.node.src!==e&&(el.largeimageloading=!0,largeimage.loadimage(e))}},activate:function(e){clearTimeout(el.timer),el.timer=setTimeout(function(){lens.show(),stage.show(),$(".zoomWindow",el).bind("mouseenter",function(){obj.deactivate()})},settings.delay)},deactivate:function(e){clearTimeout(el.timer);switch(settings.zoomType){case"drag":break;default:img.attr("title",el.imagetitle),$(el).attr("title",el.title),settings.alwaysOn?lens.setcenter():(stage.hide(),lens.hide())}el.zoom_active=!1},swapimage:function(e){el.largeimageloading=!1,el.largeimageloaded=!1;var t=$(e).data("prezoomimage"),n=$(e).attr("href");return t&&n?($(e).addClass("zoomThumbActive"),$(el).attr("href",n),img.attr("src",t),lens.hide(),stage.hide(),obj.load(),_gaq.push(["_trackEvent","product","zoom","thumbnailClick"])):(console.error("jqZoom : Missing parameter for large image or small image"),_gaq.push(["_trackEvent","product","zoom","missingParameterError"])),!1}}),img[0].complete&&(smallimage.fetchdata(),$(".zoomPad",el).length==0&&obj.create()),$(el).data("jqzoom",obj)},$.jqzoom={defaults:{zoomType:"standard",zoomWidth:300,zoomHeight:300,xOffset:10,yOffset:0,position:"right",preloadImages:!0,preloadText:"Loading zoom",title:!0,lens:!0,imageOpacity:.4,alwaysOn:!1,showEffect:"show",hideEffect:"hide",fadeinSpeed:"slow",delay:500,fadeoutSpeed:"2000"},disable:function(e){var t=$(e).data("jqzoom");return t.disable(),!1},enable:function(e){var t=$(e).data("jqzoom");return t.enable(),!1},disableAll:function(e){jqzoompluging_disabled=!0},enableAll:function(e){jqzoompluging_disabled=!1}}})(jQuery)});